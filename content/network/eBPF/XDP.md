---
aliases:
  - "XDP"
  - "eXpress Data Path"
  - "–Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–∞–∫–µ—Ç–æ–≤"
tags:
  - "#linux #network #ebpf #performance"
path:
  - "–∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã–µ/—è–¥—Ä–æ/eBPF"
---

## üìå XDP  
eXpress Data Path [[XDP]] ‚Äî –ø–æ–¥—Å–∏—Å—Ç–µ–º–∞ –≤ Linux [[kernel]], –∏—Å–ø–æ–ª—å–∑—É—é—â–∞—è [[eBPF]] –¥–ª—è —Å–≤–µ—Ä—Ö–±—ã—Å—Ç—Ä–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–µ—Ç–µ–≤—ã—Ö –ø–∞–∫–µ—Ç–æ–≤ –Ω–∞ —Å–∞–º—ã—Ö —Ä–∞–Ω–Ω–∏—Ö —ç—Ç–∞–ø–∞—Ö –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è, –¥–æ –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ —Å–µ—Ç–µ–≤–æ–π —Å—Ç–µ–∫.

## üß† –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç  
[[XDP]] –≤–Ω–µ–¥—Ä—è–µ—Ç—Å—è –≤ –¥—Ä–∞–π–≤–µ—Ä —Å–µ—Ç–µ–≤–æ–π –∫–∞—Ä—Ç—ã –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å [[eBPF]]-–ø—Ä–æ–≥—Ä–∞–º–º—ã **–¥–æ** —Ç–æ–≥–æ, –∫–∞–∫ –ø–∞–∫–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω —Å—Ç–µ–∫–æ–º [[TCPIP|TCP/IP]]. –≠—Ç–æ –¥–∞—ë—Ç:

- –ú–∏–Ω–∏–º–∞–ª—å–Ω—É—é –∑–∞–¥–µ—Ä–∂–∫—É (–±–µ–∑ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤ [[RAM]])  
- –ú–≥–Ω–æ–≤–µ–Ω–Ω—É—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –∏–ª–∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—é –ø–∞–∫–µ—Ç–æ–≤  
- –í–æ–∑–≤—Ä–∞—Ç –¥–µ–π—Å—Ç–≤–∏–π: `XDP_PASS`, `XDP_DROP`, `XDP_TX`, `XDP_REDIRECT`

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏–¥—ë—Ç —á–µ—Ä–µ–∑ `ip link` –∏–ª–∏ [[bpftool]]. –ü—Ä–æ–≥—Ä–∞–º–º–∞ –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å/–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ [[BPF Maps]], –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å [[Verifier]] –∏ –±—ã—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–π —á–µ—Ä–µ–∑ [[libbpf]].

## ‚öôÔ∏è –ì–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è

| –û–±–ª–∞—Å—Ç—å              | –ü—Ä–∏–º–µ—Ä—ã                              |
| --------------------- | ------------------------------------ |
| DDoS-–º–∏—Ç–∏–≥—Ä–∞—Ü–∏—è       | [[Cloudflare XDP]], Facebook [[XDP]] |
| IDS/IPS —Å–∏—Å—Ç–µ–º—ã       | [[Suricata eBPF]], [[Snort XDP]]     |
| –ü–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–µ CNI     | [[Cilium]], [[Katran]]               |
| –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ | [[XDP]] Load Balancer, [[Maglev]]    |
| –•–æ—Å—Ç–æ–≤–∞—è –∑–∞—â–∏—Ç–∞       | [[Tetragon]], [[XDP]] firewall       |

## üíª –ü—Ä–∏–º–µ—Ä (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π XDP-drop)

```c
SEC("xdp")
int xdp_drop(struct xdp_md *ctx) {
    return XDP_DROP;
}
````

```bash
clang -O2 -target bpf -c xdp_drop.c -o xdp_drop.o
ip link set dev eth0 xdp obj xdp_drop.o sec xdp
```

## üß© –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ XDP

```
[ NIC Driver ]
      ‚Üì
[ XDP Hook ] ‚Üê‚Üí [eBPF Program]
      ‚Üì
[ Linux TCP/IP Stack ]
```

## üìê –í–æ–∑–≤—Ä–∞—Ç –∑–Ω–∞—á–µ–Ω–∏–π XDP-–ø—Ä–æ–≥—Ä–∞–º–º—ã

|–ó–Ω–∞—á–µ–Ω–∏–µ|–î–µ–π—Å—Ç–≤–∏–µ|
|---|---|
|`XDP_DROP`|–£–¥–∞–ª–∏—Ç—å –ø–∞–∫–µ—Ç|
|`XDP_PASS`|–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –≤ —Å—Ç–µ–∫|
|`XDP_TX`|–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ —á–µ—Ä–µ–∑ —Ç–æ—Ç –∂–µ NIC|
|`XDP_REDIRECT`|–ü–µ—Ä–µ–¥–∞—Ç—å –Ω–∞ –¥—Ä—É–≥–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–ª–∏ CPU|
|`XDP_ABORTED`|–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è|

### ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- –£–ª—å—Ç—Ä–∞–Ω–∏–∑–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞, –æ–±—Ö–æ–¥ —è–¥—Ä–∞ –∏ —Å—Ç–µ–∫–æ–≤
    
- –ü–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ç—Ä–æ–∏—Ç—å user-space firewall, [[DDoS]] mitigation
    
- –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ –¥—Ä–∞–π–≤–µ—Ä–∞, –±–ª–∏–∑–∫–æ –∫ –∂–µ–ª–µ–∑—É
    

### ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏

- –¢—Ä–µ–±—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –æ—Ç [[NIC]] Driver
    
- –û—Ç–ª–∞–¥–∫–∞ —Å–ª–æ–∂–Ω–µ–µ, —á–µ–º –≤ userspace
    
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ —Å–ª–æ–∂–Ω—ã–º eBPF-–ø—Ä–æ–≥—Ä–∞–º–º–∞–º (–ø—Ä–æ–≤–µ—Ä–∫–∞ [[Verifier]])