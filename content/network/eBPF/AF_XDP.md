---
aliases:
  - "AF_XDP"
  - "Address Family XDP"
  - "XDP —Å–æ–∫–µ—Ç—ã"
tags:
  - "#linux #network #xdp #packet-processing"
path:
  - "–∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã–µ/—Å–µ—Ç–∏/—É—Å–∫–æ—Ä–µ–Ω–∏–µ"
---

## üìå AF_XDP  
Address Family XDP [[AF_XDP]] ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–æ–∫–µ—Ç–æ–≤ –≤ Linux [[kernel]], –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è –≤—ã—Å–æ–∫–æ—Å–∫–æ—Ä–æ—Å—Ç–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ —Å–µ—Ç–µ–≤—ã—Ö –ø–∞–∫–µ—Ç–æ–≤ –º–µ–∂–¥—É [[XDP]] –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ–º —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –Ω–∞–∫–ª–∞–¥–Ω—ã–º–∏ —Ä–∞—Å—Ö–æ–¥–∞–º–∏.

## üß† –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç  
[[AF_XDP]] —Ä–µ–∞–ª–∏–∑—É–µ—Ç zero-copy –ø—É—Ç—å –∏–∑ –¥—Ä–∞–π–≤–µ—Ä–∞ [[NIC]] –Ω–∞–ø—Ä—è–º—É—é –≤ userspace —á–µ—Ä–µ–∑ –º–µ—Ö–∞–Ω–∏–∑–º [[XDP]] –∏ `umem` (user memory). –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ [[DPDK]] –∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –≤–Ω–µ—à–Ω–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫.

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±—ã—á–Ω—ã–π [[Socket API]] (`AF_XDP`, `SOCK_RAW`)  
- –î—Ä–∞–π–≤–µ—Ä —Å–µ—Ç–µ–≤–æ–π –∫–∞—Ä—Ç—ã –¥–æ–ª–∂–µ–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å `xdp_zc` (zero-copy)  
- –ü—Ä–æ–≥—Ä–∞–º–º–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç RX/TX-–ø–∞–∫–µ—Ç—ã –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ mmap'–Ω—É—Ç—É—é –ø–∞–º—è—Ç—å  
- –í–æ–∑–º–æ–∂–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å [[eBPF]]-—Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –≤ [[XDP]] hook

## ‚öôÔ∏è –ì–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è

| –ö–æ–Ω—Ç–µ–∫—Å—Ç             | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ                                  |
|-----------------------|----------------------------------------------|
| Userspace firewall    | –ó–∞–º–µ–Ω–∞ [[iptables]] –¥–ª—è –≤—ã—Å–æ–∫–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏    |
| Traffic capture       | –ê–Ω–∞–ª–æ–≥ [[PF_RING]], [[libpcap]] –±–µ–∑ overhead|
| [[Load Balancer]]     | –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞–∫–µ—Ç–æ–≤ –±–µ–∑ [[DPDK]]              |
| [[Intrusion Detection]] | –õ—ë–≥–∫–∏–π [[IPS]] –Ω–∞ –±–∞–∑–µ [[eBPF]] + [[AF_XDP]]|

## üíª –ü—Ä–∏–º–µ—Ä (–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ–∫–µ—Ç–∞ AF_XDP)

```c
int sock = socket(AF_XDP, SOCK_RAW, 0);
bind(sock, ...); // –ø—Ä–∏–≤—è–∑–∫–∞ –∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
recv(sock, buf, ...); // –ø—Ä–∏—ë–º –ø–∞–∫–µ—Ç–æ–≤
````

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ `umem` (memory region), `fill queue`, `completion queue`, `rx queue` –∏ `tx queue` ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `xsk_socket__create()` –≤ [[libbpf]].

## üìê –°—Ö–µ–º–∞ –æ–±–º–µ–Ω–∞

```
[NIC] ‚áÑ [XDP Hook] ‚áÑ [AF_XDP umem] ‚áÑ [User Process]
                ‚Üñ eBPF —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
```

## üß© –û—Ç–ª–∏—á–∏—è –æ—Ç DPDK

|–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞|[[AF_XDP]]|[[DPDK]]|
|---|---|---|
|–Ø–¥—Ä–æ|–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è|–û–±—Ö–æ–¥–∏—Ç—Å—è|
|Zero-copy|–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è|–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è|
|–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–æ–∫–µ—Ç–æ–≤|–ï—Å—Ç—å (native API)|–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç|
|–°–ª–æ–∂–Ω–æ—Å—Ç—å|–ù–∏–∂–µ|–í—ã—à–µ|

### ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- –í—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –±–µ–∑ —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤
    
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π [[kernel]]-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    
- –õ–µ–≥–∫–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å [[eBPF]] –∏ [[XDP]]
    

### ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏

- –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –¥—Ä–∞–π–≤–µ—Ä–∞ –∏ —è–¥—Ä–∞
    
- –°–ª–æ–∂–Ω–∞—è –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–æ—á–µ—Ä–µ–¥–∏, mmap, buffers)
    
- –ù–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø–æ–ª–Ω–æ–π zero-copy –Ω–∞ —Å—Ç–∞—Ä—ã—Ö [[NIC]]