---
aliases:
  - "eBPF"
  - "Extended Berkeley Packet Filter"
  - "—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π BPF"
tags:
  - "#linux #kernel #network #security #tracing"
path:
  - "–∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã–µ/—è–¥—Ä–æ/eBPF"
---

## üìå eBPF  
Extended Berkeley Packet Filter [[eBPF]] ‚Äî —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è –≤ Linux [[kernel]], –ø–æ–∑–≤–æ–ª—è—é—â–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –±–∞–π—Ç-–∫–æ–¥ –≤ —è–¥—Ä–µ –¥–ª—è —Å–µ—Ç–µ–≤–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏, —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

## üß† –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç  
[[eBPF]] –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º—ã –≤ —è–¥—Ä–æ —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤ `bpf()` –∏ –∏—Å–ø–æ–ª–Ω—è–µ—Ç –∏—Ö –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ (VM), –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –≤ —è–¥—Ä–æ. –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å—Ç—Ä–æ–≥–∞—è [[Verifier]]-–ø—Ä–æ–≤–µ—Ä–∫–∞ (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏–π –∏ –¥—Ä.).

–ü—Ä–æ–≥—Ä–∞–º–º—ã [[eBPF]] –º–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫:

- –°–µ—Ç–µ–≤—ã–º —Å—Ç–µ–∫–∞–º ([[XDP]], [[TC]])
- [[Syscall]]-hook'–∞–º
- –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–µ [[kprobe]], [[uprobes]], [[tracepoints]]
- [[LSM]] (eBPF-based security modules)

–û–Ω–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç —Å –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ [[BPF Maps]].

## ‚öôÔ∏è –ì–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è

| –û–±–ª–∞—Å—Ç—å         | –ü—Ä–∏–º–µ—Ä—ã —Ä–µ—à–µ–Ω–∏–π                          |
|------------------|-------------------------------------------|
| –°–µ—Ç–µ–≤—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã  | [[XDP]], [[Cilium]], [[Suricata eBPF]]    |
| –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥       | [[bpftrace]], [[bcc]], [[perf]]           |
| –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å     | [[Tetragon]], [[KubeArmor]], [[Falco]]    |
| –û–±—Å–µ—Ä–≤–∞—Ü–∏—è       | [[Pixie]], [[Hubble]], [[Sysdig]]         |
| CNI-–ø–ª–∞–≥–∏–Ω—ã      | [[Cilium]], [[Calico eBPF]]               |

## üíª –ü—Ä–∏–º–µ—Ä (XDP —Å iptables-—ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–æ–º)

```c
SEC("xdp")
int xdp_filter(struct xdp_md *ctx) {
    // Drop –ø–∞–∫–µ—Ç—ã –ø–æ IP –∏–ª–∏ –ø–æ—Ä—Ç—É
    return XDP_DROP;
}
````

–ö–æ–º–ø–∏–ª—è—Ü–∏—è:

```bash
clang -O2 -target bpf -c xdp_filter.c -o xdp_filter.o
bpftool prog load xdp_filter.o /sys/fs/bpf/xdp_prog
ip link set dev eth0 xdp obj xdp_filter.o sec xdp
```

## üß© –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã eBPF-—ç–∫–æ—Å–∏—Å—Ç–µ–º—ã

|–ö–æ–º–ø–æ–Ω–µ–Ω—Ç|–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ|
|---|---|
|[[Verifier]]|–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ eBPF-–ø—Ä–æ–≥—Ä–∞–º–º|
|[[BPF Maps]]|–û–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏ –º–µ–∂–¥—É eBPF –∏ userspace|
|[[XDP]]|–í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞|
|[[TC BPF]]|–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–µ—Ç–µ–≤—ã–º —Å—Ç–µ–∫–æ–º (qdisc)|
|[[kprobe/tracepoint]]|–¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ —è–¥—Ä–∞|

### ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (zero-copy, bypass TCP/IP)
    
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ —è–¥—Ä–µ –±–µ–∑ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞
    
- –ì–∏–±–∫–æ—Å—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è ‚Äî –æ—Ç —Å–µ—Ç–µ–π –¥–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
    

### ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏

- –í—ã—Å–æ–∫–∏–π –ø–æ—Ä–æ–≥ –≤—Ö–æ–¥–∞ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞
    
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –≤–µ—Ä—Å–∏–π —è–¥—Ä–∞ Linux
    
- –ù–µ —Å–æ–≤–º–µ—Å—Ç–∏–º —Å —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–∞–º–∏ –∏ —è–¥—Ä–∞–º–∏
