---
aliases:
  - "libc –±–µ–∑ libc"
  - "–Ω–∞–ø–∏—Å–∞–Ω–∏–µ C –±–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏"
tags:
  - "#article #C #libc"
path:
  - "articles/c"
---

## üß† –ß—Ç–æ —Ç–∞–∫–æ–µ libc –∏ –∑–∞—á–µ–º –æ—Ç –Ω–µ—ë –æ—Ç–∫–∞–∑—ã–≤–∞—Ç—å—Å—è

[[libc]] ‚Äî —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —è–∑—ã–∫–∞ [[C]], —Ä–µ–∞–ª–∏–∑—É—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏–∏ –≤—Ä–æ–¥–µ `printf`, `malloc`, `memcpy`, `exit`. –ü–æ—á—Ç–∏ –≤—Å–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –Ω–∞ C –µ—ë –∏—Å–ø–æ–ª—å–∑—É—é—Ç, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã: [[glibc]], [[musl]], [[uClibc]], [[newlib]].

–ù–æ libc ‚Äî —ç—Ç–æ –Ω–µ —è–∑—ã–∫. –≠—Ç–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –º–µ–∂–¥—É –ø—Ä–æ–≥—Ä–∞–º–º–æ–π –∏ [[OS]], —á–∞—Å—Ç–æ —Å–∫—Ä—ã–≤–∞—é—â–∏–π –¥–µ—Ç–∞–ª–∏ –≤—ã–∑–æ–≤–æ–≤ —è–¥—Ä–∞, –∞–ª–ª–æ–∫–∞—Ü–∏–∏ –∏ –≤—ã—Ö–æ–¥–∞. –í —Å–∏—Å—Ç–µ–º–Ω–æ–º –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏, [[bootloader]], [[kernel]], [[initrd]], [[freestanding]]‚Äë–æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö –∏ [[embedded]]‚Äë—Å—Ä–µ–¥–∞—Ö —á–∞—Å—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ—Ç–∫–∞–∑–∞—Ç—å—Å—è –æ—Ç libc.

## ‚öôÔ∏è –ß—Ç–æ –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é

### –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞

Libc –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç `main()`, –Ω–æ —Ä–µ–∞–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `_start`. –ë–µ–∑ libc –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –¥–æ–ª–∂–µ–Ω –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å `_start` –∏ –∑–∞–≤–µ—Ä—à–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ `exit syscall` –∏–ª–∏ –≤—ã–∑–æ–≤ `hlt`.

```c
__attribute__((naked, section(".text")))
void _start() {
  asm volatile (
    "mov $60, %rax\n"    // syscall: exit
    "xor %rdi, %rdi\n"   // status: 0
    "syscall\n"
  );
}
````

### –í–≤–æ–¥/–≤—ã–≤–æ–¥

–§—É–Ω–∫—Ü–∏–∏ `printf`, `puts`, `read`, `write` –∑–∞–≤–∏—Å—è—Ç –æ—Ç [[syscall]] –∏ libc. –ë–µ–∑ –Ω–µ—ë ‚Äî —Ç–æ–ª—å–∫–æ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã –Ω–∞–ø—Ä—è–º—É—é:

```c
long write(int fd, const void* buf, unsigned long len) {
  long ret;
  asm volatile (
    "mov $1, %%rax\n"    // syscall: write
    "syscall"
    : "=a"(ret)
    : "D"(fd), "S"(buf), "d"(len)
    : "rcx", "r11", "memory"
  );
  return ret;
}
```

### –ê–ª–ª–æ–∫–∞—Ü–∏—è

–ë–µ–∑ `malloc`/`free` –Ω–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–º—è—Ç—å—é. –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:

- –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –∏–∑ `.bss`
    
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ [[sbrk]]/[[mmap]]
    
- –†—É—á–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è [[bump allocator]]
    

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –∫–æ–¥–æ–º, –ø–∞–º—è—Ç—å—é, –≤—Ö–æ–¥–æ–º –∏ –≤—ã—Ö–æ–¥–æ–º
    
- –°–Ω–∏–∂–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –±–∏–Ω–∞—Ä–Ω–∏–∫–∞ –¥–æ –∫–∏–ª–æ–±–∞–π—Ç
    
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–∏—Å–∞—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ ELF‚Äë—Ñ–∞–π–ª—ã, init‚Äë—É—Ç–∏–ª–∏—Ç—ã, –∑–∞–≥—Ä—É–∑—á–∏–∫–∏
    
- –£–ø—Ä–æ—â–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ –∞—É–¥–∏—Ç–∞
    

## ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏

- –ü–æ—Ç–µ—Ä—è —É–¥–æ–±—Å—Ç–≤–∞: –Ω–µ—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç—Ä–æ–∫, –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –∞–ª–ª–æ–∫–∞—Ü–∏–∏, `errno`
    
- –ù—É–∂–Ω–æ —Å–∞–º–æ–º—É —É—á–∏—Ç—ã–≤–∞—Ç—å ABI, —Å–æ–≥–ª–∞—à–µ–Ω–∏—è –æ –≤—ã–∑–æ–≤–∞—Ö, –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ
    
- –í—Å—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å C‚Äë–±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏ —Ç–µ—Ä—è–µ—Ç—Å—è
    
- –°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ—Ç–ª–∞–¥–∫–∏
    

## ‚öôÔ∏è –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

- [[OSDev]], –Ω–∞–ø–∏—Å–∞–Ω–∏–µ —è–¥—Ä–∞ –∏ —É—Ç–∏–ª–∏—Ç –Ω–∞—á–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
    
- [[bare-metal|Bare metal]] –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ RTOS
    
- –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —ç–∫—Å–ø–ª–æ–π—Ç–æ–≤, —à–µ–ª–ª–∫–æ–¥–æ–≤, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –∑–∞–≥—Ä—É–∑—á–∏–∫–æ–≤
    
- –ù–∞–ø–∏—Å–∞–Ω–∏–µ `init`, `stage1`, `freestanding` –ø—Ä–æ–≥—Ä–∞–º–º
    

## üîó –í—ã–≤–æ–¥

Libc ‚Äî –º–æ—â–Ω—ã–π, –Ω–æ —Ç—è–∂—ë–ª—ã–π —Å–ª–æ–π –Ω–∞–¥ —è–¥—Ä–æ–º. –ü–∏—Å–∞—Ç—å –±–µ–∑ –Ω–µ–≥–æ ‚Äî –∑–Ω–∞—á–∏—Ç –≤–∑—è—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ –≤–µ—Å—å –ø—É—Ç—å –æ—Ç —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞ –¥–æ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤. –≠—Ç–æ —Ç—Ä—É–¥–Ω–æ, –Ω–æ –¥–∞—ë—Ç —Ä–µ–¥–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –∫–æ–Ω—Ç—Ä–æ–ª—è, –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω—ã–π –≤ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–æ–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.