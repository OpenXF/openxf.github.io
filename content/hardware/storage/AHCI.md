---
aliases:
  - "AHCI"
  - "Advanced Host Controller Interface"
  - "интерфейс контроллера SATA"
tags:
  - "#storage #hardware #protocol"
path:
  - "компьютерные/протоколы/накопители"
---

## 📌 Кратко  
[[AHCI]] (Advanced Host Controller Interface) — стандарт интерфейса между [[SATA]]-контроллером и операционной системой, обеспечивающий эффективный доступ к накопителям через команды и [[DMA]].

## 🧠 Как работает  
[[AHCI]] определяет регистры, структуру команд и поведение контроллера SATA. Является мостом между [[Disk Controller]] и [[OS]] [[kernel]], позволяя ОС взаимодействовать с дисками через стандартные драйверы.

Ключевые возможности:
- [[NCQ]] (Native Command Queuing)  
- [[Hot plug]] (горячее подключение SATA-устройств)  
- [[DMA]]-ориентированная передача данных  
- Упрощение архитектуры драйверов и BIOS

Работает поверх [[PCI]]/[[PCIe]] и управляется через [[HBA]] (Host Bus Adapter).

## ⚙️ Где применяется

| Устройство          | Назначение                               |
|---------------------|-------------------------------------------|
| [[SATA HDD/SSD]]    | Интерфейс взаимодействия с ОС             |
| [[BIOS/UEFI]]       | Инициализация устройств в режиме AHCI     |
| [[Linux/Windows]]   | Универсальные драйверы дисков             |
| [[Laptops/Desktops]]| Поддержка горячей замены и NCQ            |

## 💻 Пример (псевдокод на уровне OS/driver)

```c
// Инициализация порта AHCI
ahci_port->cmd = 0x1; // запускаем передачу
ahci_port->ci |= (1 << slot); // указываем слот команды
````

## 🧩 Внутренние структуры

|Структура|Назначение|
|---|---|
|HBA Memory Registers|Управление портами, статусами, буферами|
|Command List|Очередь команд (NCQ)|
|Command Table|Аргументы команд, дескрипторы DMA|
|Received FIS|Ответы от диска (Frame Information Structure)|
|Ports (0–31)|До 32 подключённых устройств|

## 📐 Схема взаимодействия

```
+-----------+       +---------+       +------------+
|   OS      | ↔ DMA |  HBA    | ↔ FIS |  SATA Disk |
|  Driver   |       | (AHCI)  |       | (HDD/SSD)  |
+-----------+       +---------+       +------------+
```

### ✅ Преимущества

- Стандартизированный доступ к SATA-дискам
    
- Поддержка очередей (NCQ), DMA, горячей замены
    
- Универсальная совместимость с ОС и BIOS
    

### ❌ Недостатки

- Не оптимизирован для [[SSD]]: высокие задержки и узкая очередь
    
- Устаревание: заменяется [[NVMe]] в современных системах
    
- Зависимость от качества реализации контроллера (особенно в ноутбуках)