---
aliases:
  - "shmget"
  - "System V Shared Memory"
tags:
  - "#os #syscall #ipc"
path:
  - "–∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã–µ/–æ—Å/—Å–∏—Å—Ç–µ–º–Ω—ã–µ_–≤—ã–∑–æ–≤—ã"
---

## üìå shmget  
`shmget` ‚Äî —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤ [[System V Shared Memory]] –≤ [[Unix]]/[[Linux]], –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–ª–∏ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ —Å–µ–≥–º–µ–Ω—Ç–∞ –æ–±—â–µ–π –ø–∞–º—è—Ç–∏ (shared memory segment).

## üß† –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç  
`shmget` —Å–æ–∑–¥–∞—ë—Ç –∏–ª–∏ –ø–æ–ª—É—á–∞–µ—Ç —Å–µ–≥–º–µ–Ω—Ç –æ–±—â–µ–π –ø–∞–º—è—Ç–∏:

```c
int shmget(key_t key, size_t size, int shmflg);
````

- `key` ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, `ftok()` –∏–ª–∏ `IPC_PRIVATE`)
    
- `size` ‚Äî —Ä–∞–∑–º–µ—Ä —Å–µ–≥–º–µ–Ω—Ç–∞ –≤ –±–∞–π—Ç–∞—Ö
    
- `shmflg` ‚Äî —Ñ–ª–∞–≥–∏ –¥–æ—Å—Ç—É–ø–∞ –∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è: `IPC_CREAT`, `IPC_EXCL`, `0666`
    

–†–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî ID —Å–µ–≥–º–µ–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:

- `shmat()` ‚Äî –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ø–∞–º—è—Ç–∏
    
- `shmdt()` ‚Äî –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç —Å–µ–≥–º–µ–Ω—Ç–∞
    
- `shmctl()` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (—É–¥–∞–ª–µ–Ω–∏–µ, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è)
    

## ‚öôÔ∏è –ì–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è

|–ö–æ–Ω—Ç–µ–∫—Å—Ç|–û–ø–∏—Å–∞–Ω–∏–µ|
|---|---|
|[[Shared Memory]] (System V)|–°–æ–∑–¥–∞–Ω–∏–µ/–¥–æ—Å—Ç—É–ø –∫ –æ–±—â–µ–º—É —Å–µ–≥–º–µ–Ω—Ç—É|
|[[IPC]] –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏|–ë—ã—Å—Ç—Ä—ã–π –æ–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏ —á–µ—Ä–µ–∑ [[RAM]]|
|[[RTOS]] –∏ [[Embedded]]|–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è –ø–∞–º—è—Ç—å|

## üíª –ü—Ä–∏–º–µ—Ä (C)

```c
key_t key = ftok("file.txt", 65);
int shmid = shmget(key, 1024, 0666 | IPC_CREAT);
char *data = (char*) shmat(shmid, (void*)0, 0);
strcpy(data, "hello from shared memory");
```

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- –ü—Ä–æ—Å—Ç–æ–µ –∏ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–µ API
    
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤—Å–µ–º–∏ POSIX-—Å–∏—Å—Ç–µ–º–∞–º–∏
    
- –†–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –±–µ–∑ `mmap()`
    

## ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏

- –£—Å—Ç–∞—Ä–µ–≤—à–µ–µ API –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å [[POSIX]] Shared Memory
    
- –ù—É–∂–Ω–∞ —Ä—É—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (—á–µ—Ä–µ–∑ [[Semaphore]]/[[Mutex]])
    
- –ù–µ—É–¥–æ–±–Ω—ã–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã (`key_t`, `shmid`) –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    
- –ú–æ–≥—É—Ç –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å—Å—è "–∑–∞–≤–∏—Å—à–∏–µ" —Å–µ–≥–º–µ–Ω—Ç—ã (–±–µ–∑ `IPC_RMID`)