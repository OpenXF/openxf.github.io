---
aliases:
  - "Lock"
  - "–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞"
tags:
  - "#os #concurrency #synchronization"
path:
  - "–∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã–µ/–æ—Å/—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è"
---

## üìå Lock  
[[Lock]] ‚Äî –æ–±–æ–±—â—ë–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ä–µ—Å—É—Ä—Å—É –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π —Å—Ä–µ–¥–µ. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∑–∞—â–∏—Ç—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–µ–∫—Ü–∏–π –∫–æ–¥–∞ –æ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–æ—Ç–æ–∫–∞–º–∏.

## üß† –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç  
–ë–∞–∑–æ–≤–∞—è –∏–¥–µ—è: –ø–æ—Ç–æ–∫ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –ø–µ—Ä–µ–¥ –¥–æ—Å—Ç—É–ø–æ–º –∫ —Ä–µ—Å—É—Ä—Å—É –∏ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –µ—ë –ø–æ—Å–ª–µ.

–¢–∏–ø—ã:

- **[[Mutex]]** ‚Äî –¥–≤–æ–∏—á–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ—Ç–æ–∫–∞  
- **[[Spinlock]]** ‚Äî –∞–∫—Ç–∏–≤–Ω–æ –æ–∂–∏–¥–∞–µ—Ç —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (–±–µ–∑ —Å–Ω–∞)  
- **[[RWLock]]** ‚Äî —Ä–∞–∑–¥–µ–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø –Ω–∞ —á–∏—Ç–∞—Ç–µ–ª–µ–π (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö) –∏ –ø–∏—Å–∞—Ç–µ–ª—è (—ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π)  
- **[[Semaphore]]** ‚Äî –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∫–∞–∫ lock —Å —Å—á—ë—Ç—á–∏–∫–æ–º  
- **[[Futex]]** ‚Äî fast userspace mutex (–≥–∏–±—Ä–∏–¥ user/kernel –º–µ—Ö–∞–Ω–∏–∑–º–∞)

–û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:

- `lock()` / `acquire()` ‚Äî –∑–∞—Ö–≤–∞—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏  
- `unlock()` / `release()` ‚Äî –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ  
- `try_lock()` ‚Äî –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∞—è –ø–æ–ø—ã—Ç–∫–∞ –∑–∞—Ö–≤–∞—Ç–∞  
- `lock_with_timeout()` ‚Äî –ø–æ–ø—ã—Ç–∫–∞ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏

## ‚öôÔ∏è –ì–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è

| –û–±–ª–∞—Å—Ç—å             | –ü—Ä–∏–º–µ—Ä—ã                               |
|---------------------|----------------------------------------|
| [[Multithreading]]  | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–µ–∫—Ü–∏–∏, –æ–±—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ  |
| [[Kernel]]          | –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º  
| [[IPC]]             | –ó–∞—â–∏—Ç–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ –≤ [[Shared Memory]]   |
| [[RTOS]]            | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á –∏ ISR             |

## üíª –ü—Ä–∏–º–µ—Ä (C++ std::mutex)

```cpp
#include <mutex>
std::mutex m;

void thread_func() {
  std::lock_guard<std::mutex> guard(m);
  // –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Å–µ–∫—Ü–∏—è
}
````

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- –ü—Ä–æ—Å—Ç–∞—è –º–æ–¥–µ–ª—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
    
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ —è–∑—ã–∫–∞ –∏ –û–°
    
- –†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π (–ø–æ —Å–∫–æ—Ä–æ—Å—Ç–∏, –ø–æ–≤–µ–¥–µ–Ω–∏—é)
    

## ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏

- –†–∏—Å–∫ [[Deadlock]] –∏ [[Starvation]]
    
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ—Ç–µ—Ä–∏ –Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è—Ö
    
- –ú–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç–æ—á–∫–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏ –∏ —É–∑–∫–∏–µ –º–µ—Å—Ç–∞
    

## üõ° –°–≤—è–∑–∞–Ω–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã

- [[Atomic]] –æ–ø–µ—Ä–∞—Ü–∏–∏ ‚Äî –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º
    
- [[Condition Variable]] ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –æ–∂–∏–¥–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π
    
- [[Reader-Writer Lock]] ‚Äî —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –ø–æ —Ç–∏–ø—É –æ–ø–µ—Ä–∞—Ü–∏–π