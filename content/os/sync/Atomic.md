---
aliases:
  - "Atomic"
  - "–∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏"
  - "–∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å"
tags:
  - "#os #concurrency #synchronization #cpu"
path:
  - "–∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã–µ/–æ—Å/—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è"
---

## üìå Atomic  
[[Atomic]] ‚Äî –æ–ø–µ—Ä–∞—Ü–∏–∏, –≤—ã–ø–æ–ª–Ω—è–µ–º—ã–µ –∑–∞ –æ–¥–∏–Ω –Ω–µ–¥–µ–ª–∏–º—ã–π —à–∞–≥, –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—è –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π –∏ –≥–æ–Ω–æ–∫ –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏. –Ø–≤–ª—è—é—Ç—Å—è –æ—Å–Ω–æ–≤–æ–π –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–º –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏.

## üß† –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç  
[[root/CPU/CPU]] –∏ [[Kernel]] –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π –∑–∞ —Å—á—ë—Ç:

- –ê–ø–ø–∞—Ä–∞—Ç–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `LOCK XADD`, `CMPXCHG`)  
- –®–∏–Ω–Ω—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –∏–ª–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ [[Cache coherence]]  
- –ë–∞—Ä—å–µ—Ä–æ–≤ –ø–∞–º—è—Ç–∏ (memory fences) –¥–ª—è —Å–æ–±–ª—é–¥–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞

–û–ø–µ—Ä–∞—Ü–∏–∏:

- `atomic_load`, `atomic_store`  
- `atomic_exchange`, `atomic_fetch_add`  
- `compare_and_swap` (CAS) ‚Äî –æ—Å–Ω–æ–≤–∞ –º–Ω–æ–≥–∏—Ö lock-free –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤

–í C/C++ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ `<stdatomic.h>` –∏–ª–∏ `std::atomic`. –í Linux [[Kernel]] ‚Äî `atomic_t`, `atomic64_t`.

## ‚öôÔ∏è –ì–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è

| –û–±–ª–∞—Å—Ç—å                 | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ                          |
| ----------------------- | ----------------------------------- |
| [[Spinlock]]            | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ `test_and_set`     |
| [[Lock-free structure]] | –û—á–µ—Ä–µ–¥–∏, —Å—Ç–µ–∫–∏, –ø—É–ª—ã                |
| [[Reference Counting]]  | –ü–æ–¥—Å—á—ë—Ç —Å—Å—ã–ª–æ–∫ –±–µ–∑ [[Mutex]]        |
| [[Kernel]]              | IRQ-safe —Å—á—ë—Ç—á–∏–∫–∏, —Ñ–ª–∞–≥–∏, —Å–æ—Å—Ç–æ—è–Ω–∏—è |
| [[Multithreading]]      | –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ñ–ª–∞–≥–∏, —Å—á—ë—Ç—á–∏–∫–∏, —Å—Ç–∞—Ç—É—Å—ã |

## üíª –ü—Ä–∏–º–µ—Ä (C11 stdatomic)

```c
#include <stdatomic.h>
atomic_int counter = 0;

void increment() {
  atomic_fetch_add(&counter, 1);
}
````

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
    
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ [[Lock]]
    
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è real-time –∏ embedded —Å–∏—Å—Ç–µ–º
    

## ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏

- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—Å–ª–æ–∂–Ω–æ –≤—ã—Ä–∞–∑–∏—Ç—å —Å–ª–æ–∂–Ω—É—é –ª–æ–≥–∏–∫—É)
    
- –û—à–∏–±–∫–∏ –ø—Ä–∏–≤–æ–¥—è—Ç –∫ –Ω–µ—É–ª–æ–≤–∏–º—ã–º –±–∞–≥–∞–º
    
- –¢—Ä–µ–±—É–µ—Ç –ø–æ–Ω–∏–º–∞–Ω–∏—è –º–æ–¥–µ–ª–µ–π –ø–∞–º—è—Ç–∏ –∏ –±–∞—Ä—å–µ—Ä–æ–≤
    
- –ù–µ –≤—Å–µ–≥–¥–∞ –æ—á–µ–≤–∏–¥–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –º–µ–∂–¥—É –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞–º–∏ ([[x86]], [[ARM]])