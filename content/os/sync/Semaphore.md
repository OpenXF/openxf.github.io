---
aliases:
  - "Semaphore"
  - "—Å–µ–º–∞—Ñ–æ—Ä"
  - "counting semaphore"
tags:
  - "#os #concurrency #synchronization"
path:
  - "–∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã–µ/–æ—Å/—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è"
---

## üìå Semaphore  
[[Semaphore]] ‚Äî –ø—Ä–∏–º–∏—Ç–∏–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ —Å—á—ë—Ç—á–∏–∫–µ. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ—Ç–æ–∫–æ–≤, –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏–º–µ—é—â–∏—Ö –¥–æ—Å—Ç—É–ø –∫ —Ä–µ—Å—É—Ä—Å—É, –∏–ª–∏ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏ –∏ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏.

## üß† –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç  
–°–µ–º–∞—Ñ–æ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω—ã–π —Å—á—ë—Ç—á–∏–∫:

- `sem_wait()` (–∏–ª–∏ `P`) ‚Äî —É–º–µ–Ω—å—à–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ  
  - –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ > 0 ‚Üí –ø—Ä–æ—Ö–æ–¥  
  - –ï—Å–ª–∏ 0 ‚Üí –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∏ –æ–∂–∏–¥–∞–Ω–∏–µ  
- `sem_post()` (–∏–ª–∏ `V`) ‚Äî —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ  
  - –ú–æ–∂–µ—Ç —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –æ–∂–∏–¥–∞—é—â–∏–π –ø–æ—Ç–æ–∫

–¢–∏–ø—ã —Å–µ–º–∞—Ñ–æ—Ä–æ–≤:

- **Binary Semaphore** ‚Äî —Å—á—ë—Ç—á–∏–∫ 0/1, –∞–Ω–∞–ª–æ–≥ [[Mutex]]  
- **Counting Semaphore** ‚Äî –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω—ã–π —Å—á—ë—Ç—á–∏–∫  
- **Named Semaphore** (`sem_open`, `sem_unlink`) ‚Äî –¥–æ—Å—Ç—É–ø–µ–Ω —Ä–∞–∑–Ω—ã–º –ø—Ä–æ—Ü–µ—Å—Å–∞–º  
- **Unnamed Semaphore** (`sem_init`) ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞

## ‚öôÔ∏è –ì–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è

| –û–±–ª–∞—Å—Ç—å                   | –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è                  |
| ------------------------- | -------------------------------------- |
| [[Multithreading]]        | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—É–ª—É —Ä–µ—Å—É—Ä—Å–æ–≤    |
| [[IPC]]                   | –°–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏          |
| [[RTOS]]                  | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á, [[ISR]]           |
| [[Producer]]/[[Consumer]] | –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ –±—É—Ñ–µ—Ä—ã —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π      |
| [[Embedded]]              | –†–∞–±–æ—Ç–∞ —Å –¥–∞—Ç—á–∏–∫–∞–º–∏, —Ç–∞–π–º–µ—Ä–∞–º–∏, —Ñ–ª–∞–≥–∞–º–∏ |

## üíª –ü—Ä–∏–º–µ—Ä (POSIX Semaphore, C)

```c
#include <semaphore.h>
sem_t sem;
sem_init(&sem, 0, 1); // binary semaphore

sem_wait(&sem);  // –≤—Ö–æ–¥ –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é —Å–µ–∫—Ü–∏—é
// ...
sem_post(&sem);  // –≤—ã—Ö–æ–¥
````

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø (–≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç [[Mutex]])
    
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –º–µ–∂–ø—Ä–æ—Ü–µ—Å—Å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
    
- –ï—Å—Ç—å —è–¥—Ä–æ–≤—ã–µ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
    

## ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏

- –°–ª–æ–∂–Ω–µ–µ –≤ –æ—Ç–ª–∞–¥–∫–µ, —á–µ–º [[Mutex]]
    
- –û—à–∏–±–∫–∏ –º–æ–≥—É—Ç –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º –∏–ª–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—é —Å—á—ë—Ç—á–∏–∫–∞
    
- –í–æ–∑–º–æ–∂–Ω—ã [[Deadlock]] –∏–ª–∏ [[Starvation]] –±–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª—è –ø–æ—Ä—è–¥–∫–∞