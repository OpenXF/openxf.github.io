---
aliases:
  - "Deadlock"
  - "–≤–∑–∞–∏–º–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞"
tags:
  - "#os #concurrency #problem"
path:
  - "–∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã–µ/–æ—Å/—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è"
---

## üìå Deadlock  
[[Deadlock]] ‚Äî —Å–∏—Ç—É–∞—Ü–∏—è, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –¥–≤–∞ –∏–ª–∏ –±–æ–ª–µ–µ –ø–æ—Ç–æ–∫–æ–≤ –∏–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –Ω–∞–≤—Å–µ–≥–¥–∞ –∂–¥—É—Ç —Ä–µ—Å—É—Ä—Å–æ–≤, –∑–∞—Ö–≤–∞—á–µ–Ω–Ω—ã—Ö –¥—Ä—É–≥ –¥—Ä—É–≥–æ–º. –ù–∏ –æ–¥–∏–Ω –∏–∑ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.

## üß† –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç  
–í–∑–∞–∏–º–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç, –∫–æ–≥–¥–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ —É—Å–ª–æ–≤–∏—è (–ø–æ Coffman):

1. **–í–∑–∞–∏–º–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ** ‚Äî —Ä–µ—Å—É—Ä—Å –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–º—É –ø–æ—Ç–æ–∫—É  
2. **–£–¥–µ—Ä–∂–∞–Ω–∏–µ –∏ –æ–∂–∏–¥–∞–Ω–∏–µ** ‚Äî –ø–æ—Ç–æ–∫ —É–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–¥–∏–Ω —Ä–µ—Å—É—Ä—Å –∏ –∂–¥—ë—Ç –¥—Ä—É–≥–æ–π  
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è** ‚Äî —Ä–µ—Å—É—Ä—Å—ã –Ω–µ –∏–∑—ã–º–∞—é—Ç—Å—è  
4. **–¶–∏–∫–ª–∏—á–µ—Å–∫–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ** ‚Äî —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ü–∏–∫–ª –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏

–ü—Ä–∏–º–µ—Ä (C-like):

```c
// Thread A
lock(mutex1);
lock(mutex2); // –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è, –µ—Å–ª–∏ mutex2 –∑–∞–Ω—è—Ç Thread B

// Thread B
lock(mutex2);
lock(mutex1); // –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è, –µ—Å–ª–∏ mutex1 –∑–∞–Ω—è—Ç Thread A
````

## ‚öôÔ∏è –ì–¥–µ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç

| –û–±–ª–∞—Å—Ç—å                | –ü—Ä–∏–º–µ—Ä—ã                                               |
| ---------------------- | ----------------------------------------------------- |
| [[Multithreading]]     | –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –∑–∞—Ö–≤–∞—Ç–∞ [[Mutex]]                |
| [[Database]]           | –í–∑–∞–∏–º–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π                        |
| [[Kernel]]             | –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ [[Semaphore]]/[[Spinlock]] |
| [[FS\|Filesystem]]     | –ó–∞–≤–∏—Å–∞–Ω–∏—è –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏/—Å–Ω—è—Ç–∏–∏                     |
| [[Distributed System]] | –í–∑–∞–∏–º–Ω—ã–µ RPC-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏                              |

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ (–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç)

Deadlock ‚Äî –æ—à–∏–±–∫–∞ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–ª—é—Å ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å —É–∑–∫–∏–µ –º–µ—Å—Ç–∞ –≤ –ª–æ–≥–∏–∫–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç–∏.

## ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏

- –ü–æ–ª–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
    
- –¢—Ä—É–¥–Ω–æ—Å—Ç—å –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
    
- –ù–µ–æ—á–µ–≤–∏–¥–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π —Å—Ä–µ–¥–µ
    
- –ú–æ–∂–µ—Ç –ø—Ä–æ—è–≤–ª—è—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ (heisenbug)
    

## üõ° –ú–µ—Ç–æ–¥—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è/–æ–±—Ö–æ–¥–∞

- **–ò–∑–±–µ–∂–∞–Ω–∏–µ**: [[Lock ordering]], —Ç–∞–π–º–∞—É—Ç—ã, try-lock
    
- **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ**: –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≥—Ä–∞—Ñ–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
    
- **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ**: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ [[Mutex]]
    
- **–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ**: –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Å–Ω—è—Ç–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø–æ—Ç–æ–∫–∞