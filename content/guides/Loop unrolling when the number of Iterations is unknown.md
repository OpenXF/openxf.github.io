---
aliases:
  - "Loop unrolling with unknown count"
  - "Unrolling runtime loops"
  - "—Ä–∞–∑–≤—ë—Ä—Ç–∫–∞ —Ü–∏–∫–ª–æ–≤ —Å –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–º —á–∏—Å–ª–æ–º –∏—Ç–µ—Ä–∞—Ü–∏–π"
tags:
  - "#compiler #optimization #loop"
path:
  - "–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ/–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è/—Ü–∏–∫–ª—ã"
---

## üìå "Loop unrolling –ø—Ä–∏ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–º —á–∏—Å–ª–µ –∏—Ç–µ—Ä–∞—Ü–∏–π"  
–†–∞–∑–≤—ë—Ä—Ç–∫–∞ (unrolling) —Ü–∏–∫–ª–∞ ‚Äî —Ç–µ—Ö–Ω–∏–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π —Ç–µ–ª–æ —Ü–∏–∫–ª–∞ –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏—Ç–µ—Ä–∞—Ü–∏–π –∏ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ –ø–µ—Ä–µ—Ö–æ–¥—ã. –ï—Å–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Ç–µ—Ä–∞—Ü–∏–π –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏, –ø—Ä–∏–º–µ–Ω—è—é—Ç **—á–∞—Å—Ç–∏—á–Ω—É—é —Ä–∞–∑–≤—ë—Ä—Ç–∫—É —Å —Ö–≤–æ—Å—Ç–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π**.

## üß† –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

–ò–¥–µ—è: –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã–µ –±–ª–æ–∫–∏ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏—Ç–µ—Ä–∞—Ü–∏–π –∑–∞ —Ä–∞–∑, –∞ –∑–∞—Ç–µ–º ‚Äî –æ—Å—Ç–∞—Ç–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –¥–µ–ª–∏—Ç—Å—è –Ω–∞ —Ä–∞–∑–º–µ—Ä —Ä–∞–∑–≤—ë—Ä—Ç–∫–∏.

### –ü—Ä–∏–º–µ—Ä: —á–∞—Å—Ç–∏—á–Ω–∞—è —Ä–∞–∑–≤—ë—Ä—Ç–∫–∞ –ø–æ 4

```c
void process(int *a, int n) {
    int i = 0;
    for (; i + 3 < n; i += 4) {
        a[i]   *= 2;
        a[i+1] *= 2;
        a[i+2] *= 2;
        a[i+3] *= 2;
    }
    for (; i < n; i++) {
        a[i] *= 2; // —Ö–≤–æ—Å—Ç
    }
}
````

- **–û—Å–Ω–æ–≤–Ω–æ–π –±–ª–æ–∫**: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ 4 —ç–ª–µ–º–µ–Ω—Ç–∞
    
- **–•–≤–æ—Å—Ç–æ–≤–æ–π –±–ª–æ–∫**: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Å—Ç–∞—Ç–æ–∫ `n % 4`
    

–ö–æ–º–ø–∏–ª—è—Ç–æ—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `gcc`, `clang`) –º–æ–≥—É—Ç –¥–µ–ª–∞—Ç—å —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å —Ñ–ª–∞–≥–∞–º–∏ `-funroll-loops`, –Ω–æ —Ä—É—á–Ω–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–∞—ë—Ç –ª—É—á—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö.

## ‚öôÔ∏è –ì–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è

|–û–±–ª–∞—Å—Ç—å|–¶–µ–ª—å|
|---|---|
|[[DSP]] / [[SIMD]]|–°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ –ø–µ—Ä–µ—Ö–æ–¥—ã|
|[[HPC]]|–£–≤–µ–ª–∏—á–µ–Ω–∏–µ ILP (–ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π)|
|[[Embedded]]|–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å –≤—Ä–µ–º–µ–Ω–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è|
|[[Compiler design]]|–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –∫–æ–¥–∞|

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- –ü–æ–≤—ã—à–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ [[root/CPU/CPU]] —Å —à–∏—Ä–æ–∫–æ–π –∫–æ–Ω–≤–µ–π–µ—Ä–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π
    
- –£–ª—É—á—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É [[Instruction cache]]
    
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å [[SIMD]] (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å AVX, NEON)
    

## ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏

- –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –∫–æ–¥–∞ ([[Code bloat]])
    
- –ú–æ–∂–µ—Ç —É—Ö—É–¥—à–∏—Ç—å [[ICache]]-–ª–æ–∫–∞–ª—å–Ω–æ—Å—Ç—å
    
- –¢—Ä–µ–±—É–µ—Ç —Ç–æ—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ unroll-factor
    
- –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω –ø—Ä–∏ –º–∞–ª–æ–º —á–∏—Å–ª–µ –∏—Ç–µ—Ä–∞—Ü–∏–π